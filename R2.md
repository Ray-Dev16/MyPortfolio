# Cloudflare R2 for portfolio photos

Portfolio images (profile avatar, project images, certification images, Beyond the Screen photos) can be stored and served from **Cloudflare R2** instead of local/public storage.

## Setup

1. **Create an R2 bucket** in the [Cloudflare dashboard](https://dash.cloudflare.com/) → R2 → Create bucket.

2. **Create R2 API tokens** (R2 → Manage R2 API Tokens): create a token with Object Read & Write. Note the **Access Key ID** and **Secret Access Key**.

3. **Public access (for viewing photos):**
   - Either enable **Public access** for the bucket (R2 → your bucket → Settings → Public access) and copy the public URL (e.g. `https://pub-xxx.r2.dev`).
   - Or set up a **custom domain** (e.g. `assets.yoursite.com`) and use that as the base URL.

4. **Add to `.env`** (or Render Environment):

   ```env
   R2_ACCESS_KEY_ID=your_access_key_id
   R2_SECRET_ACCESS_KEY=your_secret_access_key
   R2_BUCKET=your-bucket-name
   R2_ENDPOINT=https://<ACCOUNT_ID>.r2.cloudflarestorage.com
   R2_REGION=auto
   R2_URL=https://pub-xxx.r2.dev
   ```

   - **R2_ENDPOINT**: In Cloudflare dashboard go to R2 → Overview; the endpoint is `https://<ACCOUNT_ID>.r2.cloudflarestorage.com` (Account ID is in the right sidebar).
   - **R2_URL**: The base URL for public objects (your R2 public bucket URL or custom domain), **no trailing slash**.

5. **Optional:** Install the S3 adapter if not already present (Laravel 12 usually includes it):

   ```bash
   composer require league/flysystem-aws-s3-v3 "^3.0"
   ```

6. **Deploy / refresh.** New uploads in the portfolio admin (avatar, project/cert images, Beyond the Screen) will go to R2 and be viewed via the URLs from `R2_URL`. Existing paths in the DB still work: they are read from the configured disk (R2 or public).

## Behaviour

- If **R2_BUCKET** (and credentials) is set, the app uses the **r2** disk for portfolio media by default.
- To force local storage even when R2 is set: `PORTFOLIO_MEDIA_DISK=public`.
- To force R2 when you use different env var names: `PORTFOLIO_MEDIA_DISK=r2`.
